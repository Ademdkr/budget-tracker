<div class="budget-form-dialog">
  <div mat-dialog-title class="dialog-header">
    <div class="header-content">
      <mat-icon class="header-icon">{{ data.isEdit ? 'edit' : 'add' }}</mat-icon>
      <h2>{{ data.isEdit ? 'Budget bearbeiten' : 'Neues Budget' }}</h2>
    </div>
    <button mat-icon-button mat-dialog-close class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div mat-dialog-content class="dialog-content">
    <form [formGroup]="budgetForm" class="budget-form">
      <!-- Period Info -->
      <div class="period-info">
        <mat-icon>calendar_month</mat-icon>
        <span>Budget für {{ getMonthName(data.month) }} {{ data.year }}</span>
      </div>

      <!-- Category Field -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Kategorie</mat-label>
        <mat-select formControlName="categoryId" [disabled]="data.isEdit">
          <mat-option *ngFor="let category of availableCategories" [value]="category.id">
            <div class="category-option">
              <div class="category-icon" [style.background-color]="category.color">
                {{ category.icon }}
              </div>
              <span>{{ category.name }}</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>category</mat-icon>
        <mat-hint *ngIf="data.isEdit"
          >Kategorie kann bei der Bearbeitung nicht geändert werden</mat-hint
        >
        <mat-error *ngIf="budgetForm.get('categoryId')?.hasError('required')">
          Kategorie ist erforderlich
        </mat-error>
      </mat-form-field>

      <!-- Target Amount Field -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Budget-Betrag</mat-label>
        <input
          matInput
          type="number"
          formControlName="targetAmount"
          placeholder="0,00"
          step="0.01"
          min="0.01"
        />
        <mat-icon matPrefix>euro</mat-icon>
        <span matSuffix class="currency-suffix">€</span>
        <mat-hint>Geben Sie den gewünschten Budgetbetrag für den Monat ein</mat-hint>
        <mat-error *ngIf="budgetForm.get('targetAmount')?.hasError('required')">
          Budget-Betrag ist erforderlich
        </mat-error>
        <mat-error *ngIf="budgetForm.get('targetAmount')?.hasError('min')">
          Budget-Betrag muss mindestens 0,01 € betragen
        </mat-error>
        <mat-error *ngIf="budgetForm.get('targetAmount')?.hasError('max')">
          Budget-Betrag darf maximal 999.999,99 € betragen
        </mat-error>
      </mat-form-field>

      <!-- Budget Preview -->
      <div class="budget-preview" *ngIf="budgetForm.get('targetAmount')?.value > 0">
        <mat-icon>preview</mat-icon>
        <div class="preview-content">
          <h4>Budget-Vorschau</h4>
          <div class="preview-item">
            <span class="preview-label">Monatliches Budget:</span>
            <span class="preview-value">{{
              formatCurrency(budgetForm.get('targetAmount')?.value || 0)
            }}</span>
          </div>
          <div class="preview-item">
            <span class="preview-label">Tägliches Budget:</span>
            <span class="preview-value">{{ formatCurrency(getDailyBudget()) }}</span>
          </div>
          <div class="preview-item">
            <span class="preview-label">Wöchentliches Budget:</span>
            <span class="preview-value">{{ formatCurrency(getWeeklyBudget()) }}</span>
          </div>
        </div>
      </div>

      <!-- Form Status -->
      <div class="form-status" *ngIf="budgetForm.invalid && budgetForm.touched">
        <mat-icon color="warn">warning</mat-icon>
        <span>Bitte korrigieren Sie die Fehler im Formular</span>
      </div>
    </form>
  </div>

  <div mat-dialog-actions class="dialog-actions">
    <div class="actions-left">
      <button mat-button type="button" (click)="onCancel()" class="cancel-button">
        <mat-icon>close</mat-icon>
        Abbrechen
      </button>
    </div>

    <div class="actions-right">
      <button
        mat-button
        type="button"
        (click)="onReset()"
        [disabled]="!budgetForm.dirty"
        class="reset-button"
      >
        <mat-icon>refresh</mat-icon>
        Zurücksetzen
      </button>

      <button
        mat-raised-button
        color="primary"
        type="submit"
        (click)="onSubmit()"
        [disabled]="budgetForm.invalid || isSubmitting"
        class="submit-button"
      >
        <mat-icon>{{ data.isEdit ? 'save' : 'add' }}</mat-icon>
        {{ data.isEdit ? 'Speichern' : 'Erstellen' }}
      </button>
    </div>
  </div>
</div>
