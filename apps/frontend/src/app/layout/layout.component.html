<div class="layout-container">
  <!-- Loading Bar -->
  <mat-progress-bar 
    *ngIf="isLoading$ | async" 
    mode="indeterminate" 
    class="global-loading-bar">
  </mat-progress-bar>

  <mat-sidenav-container class="sidenav-container">
    <!-- Sidebar -->
    <mat-sidenav #drawer class="sidenav" fixedInViewport mode="side" opened>
      <mat-toolbar class="sidenav-header">
        <mat-icon class="app-icon">account_balance_wallet</mat-icon>
        <span class="app-name">Budget Tracker</span>
      </mat-toolbar>
      
      <mat-nav-list class="nav-list">
        <a mat-list-item 
           *ngFor="let item of navigationItems"
           [routerLink]="item.route"
           routerLinkActive="active"
           class="nav-item">
          <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
          <span matListItemTitle>{{ item.label }}</span>
        </a>
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav-content>
      <!-- Top Toolbar -->
      <mat-toolbar color="primary" class="top-toolbar">
        <button
          type="button"
          aria-label="Toggle sidenav"
          mat-icon-button
          (click)="drawer.toggle()"
          class="menu-button">
          <mat-icon aria-label="Side nav toggle icon">menu</mat-icon>
        </button>

        <!-- Date Filter Section -->
        <div class="filter-section">
          <!-- Filter Type Selection -->
          <mat-form-field appearance="outline" class="filter-type">
            <mat-label>Zeitraum</mat-label>
            <mat-select [formControl]="filterTypeControl" (selectionChange)="onFilterTypeChange()">
              <mat-option value="month">Monat</mat-option>
              <mat-option value="range">Datumsbereich</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Month Picker (when month filter is selected) -->
          <mat-form-field 
            *ngIf="filterTypeControl.value === 'month'" 
            appearance="outline" 
            class="month-picker">
            <mat-label>Monat auswählen</mat-label>
            <input matInput 
                   [matDatepicker]="monthPicker" 
                   [formControl]="monthControl"
                   (dateChange)="onMonthChange()"
                   readonly>
            <mat-datepicker-toggle matIconSuffix [for]="monthPicker"></mat-datepicker-toggle>
            <mat-datepicker #monthPicker 
                           startView="year" 
                           (monthSelected)="monthControl.setValue($event); monthPicker.close(); onMonthChange()">
            </mat-datepicker>
          </mat-form-field>

          <!-- Date Range Picker (when range filter is selected) -->
          <div *ngIf="filterTypeControl.value === 'range'" class="date-range">
            <mat-form-field appearance="outline" class="start-date">
              <mat-label>Von</mat-label>
              <input matInput 
                     [matDatepicker]="startPicker" 
                     [formControl]="startDateControl"
                     (dateChange)="onDateRangeChange()">
              <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" class="end-date">
              <mat-label>Bis</mat-label>
              <input matInput 
                     [matDatepicker]="endPicker" 
                     [formControl]="endDateControl"
                     (dateChange)="onDateRangeChange()">
              <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>

        <span class="spacer"></span>

        <!-- Add Transaction Button -->
        <button mat-fab 
                color="accent" 
                class="add-transaction-fab"
                (click)="addTransaction()"
                matTooltip="Transaktion hinzufügen">
          <mat-icon>add</mat-icon>
        </button>

        <!-- User Menu -->
        <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-menu-button">
          <mat-icon>account_circle</mat-icon>
        </button>
        
        <mat-menu #userMenu="matMenu">
          <div class="user-info" *ngIf="currentUser$ | async as user">
            <mat-icon>person</mat-icon>
            <span>{{ user.email }}</span>
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Abmelden</span>
          </button>
        </mat-menu>
      </mat-toolbar>

      <!-- Main Content Area -->
      <div class="content-area">
        <router-outlet></router-outlet>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
